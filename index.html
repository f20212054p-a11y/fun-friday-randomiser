<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fun Friday â€” Team Randomiser</title>
<style>
:root{
  --bg:#1a1a2e;
  --accent:#f95d6a;
  --white:#ffffff;
}
body{margin:0;display:flex;align-items:center;justify-content:center;height:100vh;font-family:Inter,sans-serif;background:radial-gradient(circle at top left,#1f1f3a 0%,var(--bg) 70%);}
.display{
  width:400px;height:200px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.05),rgba(255,255,255,0.02));
  border:2px solid rgba(255,255,255,0.08); display:flex; justify-content:center; align-items:center; font-size:50px;font-weight:700;text-align:center; color: var(--white); transition:transform .18s ease, opacity .18s ease;
}
.btn{
  display:block;margin:20px auto;padding:14px 20px;font-size:18px;font-weight:700;background:var(--accent);color:var(--white);border:none;border-radius:12px;cursor:pointer;box-shadow:0 6px 18px rgba(249,93,106,0.25);
}
.confetti{pointer-events:none;position:fixed;inset:0;z-index:9999;overflow:hidden;}
.confetti .piece{position:absolute;font-size:18px;animation:fall 1200ms linear forwards;}
@keyframes fall{to{transform:translateY(110vh) rotate(720deg);opacity:0.98;}}
</style>
</head>
<body>

<div>
  <div class="display" id="nameDisplay">Ready?</div>
  <button class="btn" id="startBtn">ðŸŽ² Jumble & Pick</button>
</div>
<div class="confetti" id="confetti"></div>

<script>
const nameDisplay = document.getElementById('nameDisplay');
const startBtn = document.getElementById('startBtn');
const confettiContainer = document.getElementById('confetti');

let jumbleInterval=false;

// Fetch weights from JSON
async function getWeightedNames(){
  try{
    const res=await fetch('weights.json?cache='+Date.now()); // prevent caching
    return await res.json();
  } catch(e){
    alert('Cannot load names/weights. Admin may need to update.');
    return [];
  }
}

function weightedRandomPick(weightedNames){
  const total = weightedNames.reduce((sum,obj)=>sum+obj.weight,0);
  let r=Math.random()*total;
  for(let obj of weightedNames){
    if(r<obj.weight) return obj.name;
    r-=obj.weight;
  }
}

function randomFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function fireConfetti(count=22){
  const emojis=['ðŸŽ‰','âœ¨','ðŸŽˆ','ðŸ’«','ðŸ¥³'];
  for(let i=0;i<count;i++){
    const el=document.createElement('div');
    el.className='piece';
    el.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    const size=12+Math.random()*20;
    el.style.fontSize=size+'px';
    el.style.left=Math.random()*100+'%';
    el.style.top=(Math.random()*10-10)+'%';
    el.style.opacity=0.98;
    el.style.transform='translateY(-10vh) rotate('+(Math.random()*360)+'deg)';
    el.style.animationDuration=(900+Math.random()*900)+'ms';
    confettiContainer.appendChild(el);
    setTimeout(()=>el.remove(),2200);
  }
}

async function startJumble({duration=2800,speed=55}={}){
  const weightedNames = await getWeightedNames();
  if(!weightedNames.length){ alert('No names found!'); return;}
  if(jumbleInterval) return;
  nameDisplay.style.transform='scale(0.95)';
  nameDisplay.textContent='Jumbling...';

  const namesOnly=weightedNames.map(w=>w.name);
  jumbleInterval=setInterval(()=>{
    nameDisplay.style.opacity='0.95';
    nameDisplay.textContent=randomFrom(namesOnly);
    nameDisplay.style.transform='scale(1.03)';
  },speed);

  setTimeout(()=>{
    clearInterval(jumbleInterval);
    jumbleInterval=false;
    const final = weightedRandomPick(weightedNames);
    nameDisplay.textContent=final;
    nameDisplay.style.transform='scale(1.16)';
    fireConfetti();
    setTimeout(()=>{nameDisplay.style.transform='';},600);
  },duration);
}

startBtn.addEventListener('click', startJumble);
</script>
</body>
</html>
